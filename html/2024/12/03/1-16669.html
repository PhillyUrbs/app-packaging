<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>IT Pro Tips for Microsoft Azure P2S VPN Client (Non Admin) 1</title>
    <meta name="description" content="Deployment tips, questions, blogs and other technical materials related to Microsoft Azure P2S VPN Client (Non Admin) 1">
    <meta name="keywords" content="Microsoft,Microsoft Azure P2S VPN Client (Non Admin),Azure P2S VPN Client (Non Admin) 1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="yMY423DZduMGIsTKJnJbRzr_qC4FUxtEhXxtuGftSGw" />
    <link rel="apple-touch-icon" sizes="180x180" href="/build/static/layout/apple-touch-icon.png">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/build/static/layout/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/build/static/layout/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/build/static/layout/safari-pinned-tab.svg" color="#a81e25">
    <meta name="msapplication-TileColor" content="#a81e25">
    <meta name="theme-color" content="#ffffff">
            <link rel="canonical" href="http://www.itninja.com/software/microsoft/azure-p2s-vpn-client-non-admin/1-16669" />
    

    <!--
         * Quest Software Inc. PROPRIETARY INFORMATION
         *
         * This software is confidential.  Quest Software Inc., or one of its subsidiaries, has
         * supplied this software to you under the terms of a license agreement,
         * nondisclosure agreement or both.  You may not copy, disclose, or use this
         * software except in accordance with those terms.
         *
         * Copyright 2024 Quest Software Inc..  All Rights Reserved.
         *
         * Quest Software Inc. MAKES NO REPRESENTATIONS OR WARRANTIES ABOUT THE SUITABILITY OF
         * THE SOFTWARE, EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
         * IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE,
         * OR NON-INFRINGEMENT. Quest Software Inc. SHALL NOT BE LIABLE FOR ANY DAMAGES SUFFERED BY
         * LICENSEE AS A RESULT OF USING, MODIFYING OR DISTRIBUTING THIS SOFTWARE OR
         * ITS DERIVATIVES.
         *
        -->
    <link rel="stylesheet" href="/build/index.82f4a908.css">

    
            <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','GTM-P8DH2B7');</script>
        <!-- End Google Tag Manager -->
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-26553848-1']);
            _gaq.push(['_trackPageview']);

            (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();

        </script>
    
    <script type="text/javascript">

        // create the itninja JS namespace
        var Itninja = {};
        Itninja.isIe8 = false;
                var TAG_SERVER = 'tags.itninja.com',
            TAG_AUTO_SUGGEST_ENABLE = 'true' === '1' ? true : false,
            TAG_SHOW_ADD_NEW = false,
            TAG_USER_ID = 0;



    </script>
        </head>
<body>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P8DH2B7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="content-row">
    <div class="md-12">
        
<nav class="navbar navbar-inverse" role="navigation" id="main-nav">
    <div class="navbar-header">
        <div class="nav-logo-container-c"><a href="/"> <img src="/build/static/layout/ITN_logo_white.svg" class="nav-logo-collapse"/> </a></div>
        <button class="navbar-toggle" data-toggle="collapse" data-target="#main-nav-collapse" id="navbar-toggle">
            <div id="nav-icon-bar">
                <span class="nav-icon-bar-span"></span>
                <span class="nav-icon-bar-span"></span>
                <span class="nav-icon-bar-span"></span>
                <span class="nav-icon-bar-span"></span>
            </div>
        </button>
    </div>


    <div id="main-nav-collapse" class="collapse collapse-container">
        <div class="navbar-search-container">
            <form role="search" action="/search" id="nav-search">
                <div class="input-group">
                    <input type="text" name="q" placeholder="Search..." class="form-control nav-collapsed-form"/>
                    <span class="input-group-btn">
                    <button class="btn search-btn" type="submit"><img class="search-icon" src="/build/static/layout/Search_Icon_White.svg"></button>
                </span>
                </div>
            </form>
        </div>

        <ul class="collapse-list">
            <li class=""><a href="/software-library" class="nav-collapse-text">Software Tips</a></li>
            <li ><a href="/question" class="nav-collapse-text">Questions</a></li>
            <li ><a href="/blog" class="nav-collapse-text">Blogs</a></li>
            <li ><a href="/link" class="nav-collapse-text">Links</a></li>
            <li ><a href="/community" class="nav-collapse-text">Communities</a></li>
            <li ><a href="/gallery" class="nav-collapse-text">KACE Photos</a></li>
                        
            <li>
                <div>
                    <div class="user-dropdown-collapse">
                                                    <a href="/login" class="button log-in-collapse">Log in</a>
                                        </div>
            </div>
        </li>
    </ul>
    </div>

    <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav ">
            <div class="nav-logo-container"> <li> <a href="/"> <img src="/build/static/layout/ITN_logo_white.svg" class="nav-logo"> </a> </li> </div>
            <li class="nav-bar-text-first first "><a href="/software-library" class="navigation-bar-text">Software Tips</a></li>
            <li ><a href="/question" class="navigation-bar-text">Questions</a></li>
            <li ><a href="/blog" class="navigation-bar-text">Blogs</a></li>
            <li ><a href="/link" class="navigation-bar-text">Links</a></li>
            <li ><a href="/community" class="navigation-bar-text">Communities</a></li>
            <li ><a href="/gallery" class="navigation-bar-text">KACE Photos</a></li>
                                </ul>

        <div>
            <div class="user-dropdown">
                                    <div class="nav-login-container">
                        <li class="nav-login-list"><a href="/login" class="button nav-register-log-text">Log in</a></li>
                    </div>
                            </div>
        </div>

        <div id="search-form-container" class="search-form-container">
            <div class="navbar-search pull-right">
                <form class="navbar-form navbar-right" role="search" action="/search" id="nav-search">
                    <div class="input-group search-input-span box">
                        <input type="text" id="search-trigger" name="q" placeholder="Search..." class="form-control nav-search-form"/>
                        <span class="input-group-btn">
                            <button class="btn search-btn" type="submit"><img class="search-icon" src="/build/static/layout/Search_Icon_White.svg"></button>
                        </span>
                    </div>
                </form>
            </div>
        </div>


    </div>
</nav>





    </div>
</div>

    <a href="/"> <img class="breadcrumbCap" src="/build/static/layout/Breadcrumb_cap.svg" alt="/build/static/layout/Breadcrumb_cap_w.png" href="/"/></a>
    <ul id="breadcrumbs" class="breadcrumb">
        <li><a href="/">
            </a></li>
            <li><a href="/software-library">Software</a></li>
    <li><a href="/software-library/company/microsoft">Microsoft</a></li>
    <li><a href="/software-library/company/microsoft/azure-p2s-vpn-client-non-admin">Azure P2S VPN Client (Non Admin)</a></li>
    <li>1</li>
    </ul>


<div id="widget-notice" class="flash-wrap">
            </div>
<div class="body-container"  id="app">

    
<div class="itn-content">

    <div class="content-row">

        <div id="software-version-view-meta" class="md-9">
                <h2>Microsoft Azure P2S VPN Client (Non Admin)</h2>

                <div id="version-wrapper">

                    <span class="version-name" id="version-changer">
                        Version: 1
                        <div id="version-list">
                            <div class="version-list-top"></div>
                            <ul id="version-list-items" class="version-list">
                                                                    <li>
                                        <a
                                            href="/software/microsoft/azure-p2s-vpn-client-non-admin/1-16669"
                                            >
                                            1.x <span>(1 tips) </span>
                                        </a>
                                    </li>
                                                            </ul>
                        </div>
                    </span>

                    
                </div>

            </div>
        <div class="md-3">

            


    <section id="widget-signup">

    <h4>Don't be a Stranger!</h4>

    <p>Sign up today to participate,
        stay informed, earn points and establish a reputation for yourself!</p>

    <a class="btn-follow btn" rel="nofollow"
       href="/register?/follow/version/64574/JTJGc29mdHdhcmUlMkZtaWNyb3NvZnQlMkZhenVyZS1wMnMtdnBuLWNsaWVudC1ub24tYWRtaW4lMkYxLTE2NjY5">
        <span> Sign up!</span>
    </a>
    or
    <a class="" rel="nofollow"
       href="/login?/follow/version/64574/JTJGc29mdHdhcmUlMkZtaWNyb3NvZnQlMkZhenVyZS1wMnMtdnBuLWNsaWVudC1ub24tYWRtaW4lMkYxLTE2NjY5">
        login
    </a>
</section>



            <div class="tr-meta" title="Average rating 0 based on 0 votes">
                
<div id="widget-software-byline" class="pull-right">
    Views: 16.9k &nbsp|&nbsp
    Created: 09/01/2016
    
            by: <a href="/user/bongobot" rel="nofollow">bongobot</a>

    
</div><br>

<div id="widget-software-byline-stars" class="stars-wrap">
    <div name="itninja-star-rating"
     data-entity-id="64574"
     data-enabled="false"
     data-entity-name="software"
     data-rating=4
     data-expanded="false"
     data-entityType="software"
     >
</div></li>

</div>
<div id="widget-software-byline-rating" class="pull-right"> Average Rating: <span
            id="average-rating">0</span></div>
            </div>
        </div>


        <!--end header-->

    </div>


    <div class="content-row">

            </div>


        

    <div class="content-row">

        <div class="md-12">
            

<div id="widget-tags" class="tags-wrap">
    </div>
            
        </div>


        <div id="software-version-view-add-version-meta-additional" class="additional-meta md-12">
            <div class="additional-meta-content callout-box">
                <span class="glyphicon glyphicon-info-sign"></span>
                Azure P2S VPN Client (Non Admin) has <a href="#inventory-records" id="scrollInv">1 inventory records</a>,
                <a href="#q-a" id="scrollQA">0 Questions</a>,
                <a href="#blogs" id="scrollBlog">0 Blogs</a>
                and <a href="#links" id="scrollLinks">0 links</a>. Please help add to this by sharing more!
            </div>
        </div>

    </div>


    <div id="deployment-tips" class="software-section">

        <div class="callout-box2">
            <h3>
                <a href="#" class="plus toggle minus"></a> Deployment Tips (1)
                            </h3>



        </div>


                <div class="inner-content" id="deploy-div">

            <div id="deployment-ratings-summary" class="inner">

                    <div class="meta">
                        <strong>Most Common Setup Type</strong>
                        <div>
                            Legacy Setup with command line support
                        </div>
                    </div>
                    <div class="meta meta-middle">
                        <strong>Average Package Difficulty Rating</strong>
                        <img src="/build/static/software/orange.png" class="img-responsive" />
                        <div class="rating-text">
                            Rated <strong>4 / 5 (Somewhat Difficult)</strong>
                            based on <strong>1</strong> ratings
                        </div>
                    </div>
                    <div class="meta">
                        <strong>Most Commonly Reported Deployment Method</strong>
                        <div>
                            Repackaged (to a proprietary Format)
                        </div>
                    </div>

            </div>

            <!-- end rating section -->
            
                                                        

            

            <ul class="nav nav-tabs" id="tips">

                    <li class="active">
                        <a href="/software/microsoft/azure-p2s-vpn-client-non-admin/1-16669#tips">
                            All Tips
                        </a>
                    </li>
                                           <li ><a href="/software/microsoft/azure-p2s-vpn-client-non-admin/1-16669/windows#tips">
                               Windows Tips
                            </a>
                       </li>
                                    </ul>

            </ul>

                    <div id="software-version-tips" class="inner">

                
    <div>
        
    
        <div class="tip" id="tip_8419" name="tip_8419">

            <div class="md-1">
                <div class="software-rating-container">
                

    
<div id="incremental-rating" class="incrementalRating">
<!--   <div class="arrow_up" id="tip-8419"></div> -->
   <div id="tip-8419" class="thumbs_up"><button class="btn btn-xs btn-link "><div class="comment-vote-up"><img src="/build/static/rating/UpArrow.svg"/></div></button></div>
    <div class="avg-rating">0</div>
   <div id="tip-8419" class="thumbs_down"><button class="btn btn-xs btn-link "><div class="comment-vote-down"><img src="/build/static/rating/DownArrow.svg"/></div></button></div>
   <!--<div class="arrow_down" id="tip-8419"></div> -->
</div>
                </div>
            </div>

            
<div class="md-11">
    <div class="the-tip">

                
        <div class="tip-type-heading">Script</div>

            <span id="tip-text">
            <p class="MsoListParagraphCxSpFirst" style="text-indent:-18pt;">1.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">     </span></p><p class="MsoListParagraphCxSpFirst" style="text-indent:-18pt;"><span>      The Azure P2S (Point to Site) VPN Client Traditionally installs per user and requires administrative rights to install. This means that in order to use the P2S VPN users must have local admin rights on their workstations, which is not possible in most enterprise environments. This guide provides a method for deploying the Azure P2S VPN client without the need for User local admin rights, it is installed with admin rights on the computer and is able to be used by all users on the workstation (assuming they have a valid user certificate as per standard Azure P2S configuration). This solution works with SCCM and other deployment mechanisms and is perfectly suitible for clients connecting into a DR environment in Azure Site recovery. I was not able to find another solution to this at the time of posting so i hope this will be of some help. <br /></span></p><p class="MsoListParagraphCxSpFirst" style="text-indent:-18pt;"><span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">Th</span></p><p class="MsoListParagraphCxSpFirst" style="text-indent:-18pt;"><span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';"><br /></span></p><p class="MsoListParagraphCxSpFirst" style="text-indent:-18pt;"><span style="text-indent:-18pt;font-size:7pt;line-height:normal;font-family:'Times New Roman';">         </span><span style="text-indent:-18pt;line-height:1.42857;">1. Download VPN client from Azure</span><br /></p><p class="MsoListParagraphCxSpFirst" style="text-indent:-18pt;"></p><p></p><p class="MsoListParagraphCxSpFirst" style="text-indent:-18pt;"><img src="/uploads/images/133152/xLIczn.jpeg" style="width:294px;" alt="xLIczn.jpeg" /><br /></p>

<p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;">2.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">       </span><span style="line-height:1.42857;">2. </span><span style="text-indent:-18pt;line-height:1.42857;">Extract the package using the following command {guid}.exe
/T:{Path to Extract Folder} /C</span></p><p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;"><span style="text-indent:-18pt;line-height:1.42857;"><img src="/uploads/images/133152/zRYcHJ.jpeg" style="width:500px;" alt="zRYcHJ.jpeg" /><br /></span></p><p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;"></p><p></p>

<p class="MsoListParagraphCxSpMiddle"></p><p></p>

<p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;">3.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">       </span><span style="line-height:1.42857;">3. </span><span style="text-indent:-18pt;line-height:1.42857;">Find the {guid}.pbk file -&gt; right click -&gt;
edit in notepad</span></p><p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;"></p><p></p>

<p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;">4.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">       </span><span style="line-height:1.42857;">4. </span><span style="text-indent:-18pt;line-height:1.42857;">Go through the PBK file until you find an entry
called “PhoneNumber=”, the string after this is the URL your VPN will connect
to. Record this URL for later use</span></p><p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;"><span style="text-indent:-18pt;line-height:1.42857;">       <img src="/uploads/images/133152/XtnNGm.png" style="width:500px;" alt="XtnNGm.png" /><br /></span></p><p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;"></p><p></p>

<p class="MsoListParagraphCxSpMiddle"></p><p></p>

<p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;">5.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">      </span><span style="line-height:1.42857;">5.</span><span style="text-indent:-18pt;font-size:7pt;line-height:normal;font-family:'Times New Roman';"> </span><span style="text-indent:-18pt;line-height:1.42857;">In the extracted folder locate the {guid}.cer
certificate file and copy it to a new folder where the package will be built.</span></p><p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;"></p><p></p>

<p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;">6.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">       </span><span style="line-height:1.42857;">6.</span><span style="text-indent:-18pt;line-height:1.42857;">Now you need to get the thumbprint of the
certificate file. Double click on the {guid}.cer file  to bring up the certificate properties and Navigate
to the details tab</span></p><p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;"><span style="text-indent:-18pt;line-height:1.42857;">       <img src="/uploads/images/133152/4zxZEM.jpeg" style="width:292px;" alt="4zxZEM.jpeg" /><br /></span></p><p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;"><span style="text-indent:-18pt;line-height:1.42857;"><br /></span></p><p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;"></p><p></p>

<p class="MsoListParagraphCxSpMiddle"></p><p></p>

<p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;">7.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">       </span><span style="line-height:1.42857;">7. </span><span style="text-indent:-18pt;line-height:1.42857;">In the “Show” drop down box select “Properties
Only” and highlight the Thumbprint item        .</span></p><p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;"></p><p></p>

<p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;">8.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">       </span><span style="line-height:1.42857;">8. </span><span style="text-indent:-18pt;line-height:1.42857;">Select the thumbrint in the bottom section and copy and paste
the string to notepad</span></p><p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;"><span style="text-indent:-18pt;line-height:1.42857;">        <img src="/uploads/images/133152/CnCRAd.jpeg" style="width:290px;" alt="CnCRAd.jpeg" /><br /></span></p><p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;"></p><p></p>

<p class="MsoListParagraphCxSpMiddle"></p><p></p>

<p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;">9.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">       </span><span style="line-height:1.42857;">9. </span><span style="text-indent:-18pt;line-height:1.42857;">In notepad remove all the spaces from the
thumbprint string and record the modified string for future use</span></p><p class="MsoListParagraphCxSpMiddle" style="text-indent:-18pt;"></p><p></p>

<p class="MsoListParagraphCxSpMiddle"></p><p></p>

<p class="MsoListParagraphCxSpMiddle"></p><p> <img src="/uploads/images/133152/qbnRgr.jpeg" style="width:500px;" alt="qbnRgr.jpeg" /></p>

<p class="MsoListParagraphCxSpLast" style="text-indent:-18pt;">1   <span style="line-height:1.42857;">10.</span><span style="text-indent:-18pt;font-size:7pt;line-height:normal;font-family:'Times New Roman';">   </span><span style="text-indent:-18pt;line-height:1.42857;">Create a new Powershell script  in the same packaging folder as the
certificate and copy and paste the below code into the script:</span></p><p class="MsoListParagraphCxSpLast" style="text-indent:-18pt;"></p><p></p>

<p class="MsoNormal" style="margin-left:18pt;"></p><p> </p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">#Define These Properties</span><span style="font-size:9pt;font-family:'Lucida Console';"></span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">$certificatefile</span><span style="font-size:9pt;font-family:'Lucida Console';"> <span>=</span> <span>"&lt;name of
certificate file here&gt;"</span> </span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">$vpnurl</span><span style="font-size:9pt;font-family:'Lucida Console';"> <span>=</span> <span>"&lt;vpn url from pbk PhoneNumber&gt;"</span></span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">$Thumbprint</span><span style="font-size:9pt;font-family:'Lucida Console';"> <span>=</span> <span>"&lt;Certificate
Thumbprint without spaces&gt;"</span></span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">$connectionName</span><span style="font-size:9pt;font-family:'Lucida Console';"> <span>=</span> <span>"&lt;display
Name for your VPN connection&gt;"</span></span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';"></span></p><p> </p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';"></span></p><p> </p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">$dir</span><span style="font-size:9pt;font-family:'Lucida Console';"> <span>=</span> <span style="color:#0000FF;">Split-Path</span> (<span>$MyInvocation</span><span>.</span>MyCommand<span>.</span>Path)</span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">$connections</span><span style="font-size:9pt;font-family:'Lucida Console';"> <span>=</span> <span style="color:#0000FF;">Get-VpnConnection</span>
<span style="color:#000080;">-AllUserConnection</span> </span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">$connectionexists</span><span style="font-size:9pt;font-family:'Lucida Console';"> <span>=</span> <span>$false</span></span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">if</span><span style="font-size:9pt;font-family:'Lucida Console';"> (<span>!</span>(<span style="color:#0000FF;">Test-Path</span> <span>"Cert:\LocalMachine\root\</span><span>$thumbprint</span><span>"</span>))
{ </span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';"> <span style="color:#0000FF;">Start-Process</span> <span>"certutil.exe"</span> <span style="color:#000080;">-ArgumentList</span>
<span>"-addstore root `"</span><span>$dir</span><span>\</span><span>$certificateFile</span><span>`""</span></span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">}</span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">foreach</span><span style="font-size:9pt;font-family:'Lucida Console';"> (<span>$connection</span>
<span>in</span> <span>$connections</span>)
{ </span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">    <span>if</span> (<span>$connection</span><span>.</span>Name
<span>-eq</span> <span>$connectionName</span>)
{ </span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">        <span>$connectionexists</span>
<span>=</span> <span>$true</span></span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">    }</span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">}
</span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">if</span><span style="font-size:9pt;font-family:'Lucida Console';"> (<span>$connectionexists</span>
<span>-eq</span> <span>$false</span>)
{ </span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">    <span>$EAP</span> <span>=</span> <span style="color:#0000FF;">New-EapConfiguration</span>
<span style="color:#000080;">-verifyServerIdentity</span> <span style="color:#000080;">-UserCertificate</span>
<span style="color:#000080;">-Tls</span></span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">    <span style="color:#0000FF;">Add-VpnConnection</span>
<span style="color:#000080;">-Name</span> <span>$connectionName</span>
<span style="color:#000080;">-ServerAddress</span> <span>$vpnurl</span>
<span style="color:#000080;">-TunnelType</span> <span>SSTP</span>
<span style="color:#000080;">-EncryptionLevel</span> <span>Required</span>
<span style="color:#000080;">-AuthenticationMethod</span> <span>Eap</span>
<span style="color:#000080;">-EapConfigXmlStream</span> <span>$EAP</span><span>.</span>EapConfigXmlStream <span style="color:#000080;">-SplitTunneling</span>
<span style="color:#000080;">-AllUserConnection</span> <span style="color:#000080;">-Force</span>
<span style="color:#000080;">-PassThru</span></span></p><p></p>

<p class="MsoNormal" style="margin-bottom:.0001pt;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';">}  </span></p><p></p>

<p class="MsoNormal" style="margin-left:18pt;"></p><p> </p>

<p class="MsoNormal" style="margin-left:18pt;"></p><p> </p>

<p class="MsoNormal" style="margin-left:18pt;"></p><p> </p>

<p class="MsoListParagraphCxSpFirst" style="text-indent:-18pt;">11.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">  </span><span style="line-height:1.42857;">11. </span><span style="text-indent:-18pt;line-height:1.42857;">In the section “Define These Properties” Replace
the strings with the relevant information</span></p><p class="MsoListParagraphCxSpFirst" style="text-indent:-18pt;"><span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';"></span></p><p></p>

<p class="MsoListParagraphCxSpMiddle" style="margin-left:72pt;text-indent:-18pt;">a.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">      
</span>$certificatefile – The name of the .cer file
copied into the packaging folder </p><p></p>

<p class="MsoListParagraphCxSpMiddle" style="margin-left:72pt;text-indent:-18pt;">b.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">     
</span>$vpnurl – the url copied out of the pbk file
with the property name PhoneNumber (Does not include the “PhoneNumber=” component,
just the following URL)</p><p></p>

<p class="MsoListParagraphCxSpMiddle" style="margin-left:72pt;text-indent:-18pt;">c.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">      
</span>$thumbprint – The thumbprint string with no
spaces previously manipulated in notepad. </p><p></p>

<p class="MsoListParagraphCxSpMiddle" style="margin-left:72pt;text-indent:-18pt;">d.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">     
</span>$connectionName – A name for the connection.
This will be displayed to the user under network connections</p><p></p><p class="MsoListParagraphCxSpMiddle" style="margin-left:72pt;text-indent:-18pt;"><br /></p><p class="MsoListParagraphCxSpMiddle" style="margin-left:72pt;text-indent:-18pt;"><img src="/uploads/images/133152/zjc96B.jpeg" style="width:500px;" alt="zjc96B.jpeg" /><br /></p>

<p class="MsoListParagraphCxSpMiddle">12. Run this script with
administrative rights to install the VPN connection for all users on the
system. Users will require user certificates in order to authenticate as per
standard Azure P2S VPN configuration. </p><p></p>

<p class="MsoListParagraphCxSpMiddle"></p><p> </p><p class="MsoListParagraphCxSpMiddle"></p><p><br /></p><p class="MsoListParagraphCxSpMiddle"></p><p><br /></p><p class="MsoListParagraphCxSpMiddle"><br /></p>

<p class="MsoListParagraphCxSpLast"></p><p> </p>
            </span>
            <div class="setup-wrap">

                <div class="setup-header">Setup Information:</div>

                <div>Setup Type: <span>Legacy Setup with command line support</span></div>
                <div>Deployment Method Used: <span>Repackaged (to a proprietary Format)</span></div>
                <div>
                    Deployment Difficulty: <span>
                                            Somewhat Difficult
                                        </span>
                </div>
                <div>Platform(s): <span>Windows </span></div>
            </div>
            <!--end setup-->


        <div class="byline">
            <ul>
                <li>
                    <a href="/user/bongobot" class="username" rel="nofollow">bongobot</a>
                </li>
                <li>
                    09/01/2016 &nbsp;
                </li>
                                <li>
                    <span class="commentslabel collapsed-comments">Show Comments </span> &nbsp; ( 1 )
                </li>
                <li>
                                    </li>
                <li>
                                    </li>
            </ul>
            <br class="clear"/>
        </div>

</div>
</div>

            <div class="deployment-tips-comments">

                <ul id="comment-list" class="comments">
            <li id="comment-54875">
            <a name="comment-54875"></a>
            




    
        <div class="comment-wrap">
            <div >
                                <div class="the-comment">Hi, Thanks for sharing this guide. I followed the steps in your guide and I was able to install using Powershell script but whenever I connect, it doesn't add the destination IP to my routing table. Kindly assist. -
                    <a class="username" href="/user/Temmytorpe86" rel="nofollow">Temmytorpe86</a>
                    <small>4 years ago</small>
                </div>

                    <div class="small-moderation-tools comment-links">
                        <ul>
                                                            <li>
                                                                    </li>
                                <li class="report-spam-link-container">
                                                                    </li>
                                                                
                                                                                </ul>

                    </div>

            </div>

        </div>

        <ul id="comment-list" class="comments">
            <li id="comment-54885">
            <a name="comment-54885"></a>
            




    
        <div class="comment-wrap">
            <div >
                                <div class="the-comment">I think you will need to add the route separately, there is a seperate cmdlet for adding the route <br />
add-vpnconnectionroute  https://docs.microsoft.com/en-us/powershell/module/vpnclient/add-vpnconnectionroute?view=win10-ps -
                    <a class="username" href="/user/bongobot" rel="nofollow">bongobot</a>
                    <small>4 years ago</small>
                </div>

                    <div class="small-moderation-tools comment-links">
                        <ul>
                                                            <li>
                                                                    </li>
                                <li class="report-spam-link-container">
                                                                    </li>
                                                                
                                                                                </ul>

                    </div>

            </div>

        </div>

        <ul id="comment-list" class="comments">
            <li id="comment-54890">
            <a name="comment-54890"></a>
            




    
        <div class="comment-wrap">
            <div >
                                <div class="the-comment">Thanks a bunch, this works perfectly fine for me. You took away a lot of stress for me. kudos. -
                    <a class="username" href="/user/Temmytorpe86" rel="nofollow">Temmytorpe86</a>
                    <small>4 years ago</small>
                </div>

                    <div class="small-moderation-tools comment-links">
                        <ul>
                                                            <li>
                                                                    </li>
                                <li class="report-spam-link-container">
                                                                    </li>
                                                                
                                                                                </ul>

                    </div>

            </div>

        </div>

        <ul id="comment-list" class="comments">
    </ul>


    </li>
    </ul>


    </li>
    </ul>


    </li>
            <li id="comment-54889">
            <a name="comment-54889"></a>
            



</li>
    </ul>


                            </div>

        </div>
        </div>

                
            </div>

                    </div>

    </div>
    <!-- end Deployment Tips -->

    <div class="software-section" id="inventory-records">

        <div class="callout-box2">

            <h3><a href="#" class="plus toggle"></a> Inventory Records (1)</h3>
            <p>View inventory records anonymously contributed by opt-in users of the
                <a href="http://software.dell.com/products/kace-k1000-systems-management-appliance">
                K1000 Systems Management Appliance</a>.
            </p>

        </div>

        <div class="inner-content">

            <div class="inner">

                <div id="software-view-version-revision-list">
                    <div class="title">Versions</div>
                    <ul class="no-bullet nav nav-pills">
                                                    <li class="active">
                                <a href="/software/version/revision/64574/136363">
                                    1
                                </a>
                            </li>
                                            </ul>
                </div>
                <div id="software-view-version-revision-details">
                                            <h2>Azure P2S VPN Client (Non Admin)</h2>
            <div><h3>Version</h3><span>1</span></div>
                                                                                                    
                                    </div>
                <br class="clear"/>
            </div>

        </div>

    </div>
    <!-- end inventory records section -->

    <div class="software-section" id="q-a">

        <div class="callout-box2">

            <h3>
                <a href="#" class="plus toggle"></a> Questions & Answers (0)
                            </h3>
            <p>Questions & Answers related to Microsoft Azure P2S VPN Client (Non Admin)</p>

        </div>

        <div class="inner-content">

            <div class="inner">

                
                            </div>

        </div>
    </div>
    <!-- end Q & A section -->

    <div class="software-section" id="blogs">

        <div class="callout-box2">

            <h3>
                <a href="#" class="plus toggle"></a> Blogs (0)
                            </h3>
            <p>Blog posts related to Microsoft Azure P2S VPN Client (Non Admin)</p>

        </div>
        <div class="inner-content">

            <div class="inner">

                
                            </div>

        </div>
    </div>
    <!-- end blog section -->

    <div class="software-section" id="links">

        <div class="callout-box2">

            <h3>
                <a href="#" class="plus toggle"></a> Links (0)
                            </h3>

            <p>Links related to Microsoft Azure P2S VPN Client (Non Admin)</p>

        </div>

        <div class="inner-content">

            <div class="inner">

                
                            </div>

        </div>
    </div>
    <!-- end links section -->

    <!-- reviews -->
        <div class="software-section" id="reviews">

           <div class="callout-box2">

               <h3>
                   <a href="#" class="plus toggle"></a> Reviews (0)
                                  </h3>

               <p>Reviews related to Microsoft Azure P2S VPN Client (Non Admin)</p>

           </div>

           <div class="inner-content">

               <div class="inner">


                   
               </div>

           </div>

       </div>


</div>
    <div class="clearfix">&nbsp;</div>
</div>
<div class="ccpa-notification">
    <div class="ccpa-notification-text">
        <div><button class="btn-itn" id="ccpa-accept">ACCEPT</button></div>

        This website uses cookies.
        By continuing to use this site and/or clicking the "Accept" button you are providing consent


        Quest Software and its affiliates do NOT sell the Personal Data you provide to us either when you register on our
        websites or when you do business with us. For more information about our
        <a href="https://www.quest.com/legal/privacy.aspx" target="_blank" rel="noopener noreferrer">Privacy Policy</a> and our data protection
        efforts, please visit
        <a href="https://www.quest.com/legal/gdpr-hq.aspx" target="_blank" rel="noopener noreferrer">GDPR-HQ</a>
        </div>
    </div>
</div>


<footer>
    <div class="container">
                <div id="footer-nav" class="row">
            <div class="md-3">
                <strong>Home Pages</strong>
                <ul>
                    <li><a href="/software-library">Software</a></li>
                    <li><a href="/question">Questions</a></li>
                    <li><a href="/blog">Blog Posts</a></li>
                    <li><a href="/link">Shared Links</a></li>
                </ul>
            </div>
            <div class="md-3">
                <strong>FAQ &amp; Support</strong>
                <ul>
                    <li><a href="/faq">Site FAQ</a></li>
                    <li><a href="https://www.quest.com/community/quest/unified-endpoint-management" target="_blank" rel="noopener noreferrer">Unified Endpoint Management</a></li>
                </ul>
            </div>
            <div class="md-3">
                <strong>About</strong>
                <ul>
                    <li><a href="/about">ITNinja</a></li>
                    <li><a href="/about">Welcome Video</a></li>
                    <li><a href="/tour">Tour</a></li>
                    <li><a href="/contact">Contact</a></li>
                    <li><a href="/sitemap">Sitemap</a></li>
                </ul>
            </div>
            <div class="md-3">
                <strong>Share/Contribute</strong>
                <ul>
                    <li class="pull-left"><a href="http://www.facebook.com/pages/ITNinja/128951133849867"><img src="/build/static/layout/facebook.png" alt="Facebook"></a></li>
                    <li class="pull-left">&nbsp;&nbsp;</li>
                    <li class="pull-left"><a href="http://twitter.com/ITNinjaSite"><img src="/build/static/layout/twitter.png" alt="Twitter"></a></li>
                </ul>
            </div>
        </div>

        <div id="footer-links">
            &copy; 2024 Quest Software Inc. All rights reserved.  &nbsp; <a href="/legal">Legal</a> &nbsp; | &nbsp; <a href="https://kace.uservoice.com/forums/139919-itninja">Feedback</a>
            <a href="https://www.quest.com/kace/" class="footer-logo-kace"><img src="/build/static/layout/KACE_White-grey.png" alt="KACE" /></a>
            <a href="https://www.quest.com/" class="footer-logo"><img src="/build/static/layout/dsg.png" alt="Quest" /></a>
        </div>

        <div id="version">unknown</div>

    </div>

</footer>

<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>

<script src="/build/index.5c9f75e6.js"></script>


    <script src="/build/software.afa0d704.js"></script>

    <script>
        Itninja.Helpful('div.helpful button');
        Itninja.HideContent('a.review-delete-admin','div.version-review');

        $(document).ready( function() {
            tagging.init($('#form_tags'), {'suggest':false});

            // only way to do this
                             var id = '#platform-new #form_platforms_' + 1;
                $(id).click(function() {
                    showNotificationBar('This platform is associated to one or more tips. Please modify the tip prior to removing this platform',1200);
                    // reclick it
                    $(this).attr("checked", true);
                });
            

            $("input#difficulty[data-slider]").bind("slider:changed", function (event, data) {

                difficultyValue = data.value.toFixed(0);

                // set difficulty dropdown to value from slider
                $("select#difficultyRating").val(difficultyValue);

                // get difficulty phrase
                var phrase = $('select#difficultyRating option:selected').html();

                if (phrase) {
                    // set slider phrase span
                    $('#slider-value').html("Difficulty: <span class='diff_" + difficultyValue + "'>" + phrase + "</span>");
                }

                if ( data.value == 0){
                     $('.slider-back').addClass('slider-disabled');
                     $('#slider-value span').removeClass('diff_1');
                 } else {
                    $('.slider-back').removeClass('slider-disabled');
                 }

            })
        });
    </script>


</body>
</html>
